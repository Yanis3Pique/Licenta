@{
    ViewBag.Title = "Create Delivery";
    var availableOrders = ViewBag.AvailableOrders as List<Order>;
    var availableDrivers = ViewBag.AvailableDrivers as List<ApplicationUser>;
    var availableVehicles = ViewBag.AvailableVehicles as List<Vehicle>;
}

@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}
@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="~/js/create_delivery.js"></script>

<!-- Container pt progresul capacitatii -->
<div id="capacity-progress" data-total-weight="1" data-total-volume="1" class="mb-3">
    <div class="mb-1">Weight: <span id="weightValue">0 / 1 kg</span></div>
    <div class="progress mb-2">
        <div id="weightProgress" class="progress-bar bg-primary" role="progressbar" style="width: 0%;"></div>
    </div>
    <div class="mb-1">Volume: <span id="volumeValue">0 / 1 m³</span></div>
    <div class="progress">
        <div id="volumeProgress" class="progress-bar bg-info" role="progressbar" style="width: 0%;"></div>
    </div>
</div>

<form method="post" asp-action="CreateDelivery">
    <div class="mb-3">
        <label for="driverSelect">Select Driver:</label>
        <select id="driverSelect" name="driverId" class="form-control">
            @foreach (var driver in availableDrivers)
            {
                <option value="@driver.Id">@driver.UserName</option>
            }
        </select>
    </div>

    <div class="mb-3">
        <label for="vehicleSelect">Select Vehicle:</label>
        <select id="vehicleSelect" name="vehicleId" class="form-control">
            @foreach (var vehicle in availableVehicles)
            {
                <option value="@vehicle.Id"
                        data-maxweight="@vehicle.MaxWeightCapacity"
                        data-maxvolume="@vehicle.MaxVolumeCapacity">
                    @vehicle.Brand @vehicle.Model (@vehicle.RegistrationNumber)
                </option>
            }
        </select>
    </div>

    <div class="mb-3">
        <h4>Available Orders</h4>
        @foreach (var order in availableOrders)
        {
            <div class="form-check">
                <input type="checkbox"
                       class="form-check-input order-checkbox"
                       name="selectedOrderIds"
                       value="@order.Id"
                       data-weight="@order.Weight"
                       data-volume="@order.Volume"
                       data-latitude="@order.Latitude"
                       data-longitude="@order.Longitude"
                       id="order_@order.Id" />
                <label class="form-check-label" for="order_@order.Id">
                    Order #@order.Id - @order.Address <br />
                    <small>@order.Weight kg, @order.Volume m³</small>
                </label>
            </div>
        }
    </div>
    <button type="submit" id="createDeliveryButton" class="btn btn-primary">Create Delivery</button>
</form>

<div id="map" style="width: 100%; height: 500px; margin-top: 20px;"></div>