@{
    ViewBag.Title = "Edit Delivery";
    var availableOrders = ViewBag.AvailableOrders as List<Licenta_v1.Models.Order>;
}

@if (TempData["Success"] != null)
{
    <div class="alert alert-success">@TempData["Success"]</div>
}
@if (TempData["Error"] != null)
{
    <div class="alert alert-danger">@TempData["Error"]</div>
}

<h2 class="text-center mb-4">@ViewBag.Title @Model.Id</h2>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="~/js/edit_delivery.js"></script>

<!-- Container pt progresul capacitatii -->
<div id="capacity-progress"
     data-total-weight="@Model.Vehicle.MaxWeightCapacity"
     data-total-volume="@Model.Vehicle.MaxVolumeCapacity">
    <div class="mb-3">
        <label class="form-label">Weight Usage</label>
        <div class="progress" style="height: 25px;">
            <div id="weightProgress" class="progress-bar bg-primary" role="progressbar" style="width: 0%;"
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="@Model.Vehicle.MaxWeightCapacity"></div>
        </div>
        <div id="weightValue" class="mt-1">0 / @Model.Vehicle.MaxWeightCapacity kg</div>
    </div>
    <div class="mb-3">
        <label class="form-label">Volume Usage</label>
        <div class="progress" style="height: 25px;">
            <div id="volumeProgress" class="progress-bar bg-info" role="progressbar" style="width: 0%;"
                 aria-valuenow="0" aria-valuemin="0" aria-valuemax="@Model.Vehicle.MaxVolumeCapacity"></div>
        </div>
        <div id="volumeValue" class="mt-1">0 / @Model.Vehicle.MaxVolumeCapacity m³</div>
    </div>
</div>

<form asp-action="EditDelivery" method="post">
    <input type="hidden" name="id" value="@Model.Id" />

    <!-- Comenzi deja in Delivery -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>Current Orders</h5>
            <small class="text-muted">Uncheck the orders that you want to remove from the delivery.</small>
        </div>
        <div class="card-body">
            @foreach (var order in Model.Orders)
            {
                <div class="form-check">
                    <input class="form-check-input"
                           type="checkbox"
                           name="keepOrderIds"
                           value="@order.Id"
                           id="currentOrder_@order.Id"
                           checked="checked"
                           data-weight="@order.Weight"
                           data-volume="@order.Volume"
                           data-latitude="@order.Latitude"
                           data-longitude="@order.Longitude" />
                    <label class="form-check-label" for="currentOrder_@order.Id">
                        #@order.Id - @order.Address (Placed: @order.PlacedDate.ToString("d"))
                    </label>
                </div>
            }
        </div>
    </div>

    <!-- Comenzi de adaugat la cerere -->
    <div class="card mb-4">
        <div class="card-header">
            <h5>Add Orders</h5>
            <small class="text-muted">Select the orders that you want to add to the delivery.</small>
        </div>
        <div class="card-body">
            @if (availableOrders != null && availableOrders.Any())
            {
                @foreach (var order in availableOrders)
                {
                    <div class="form-check">
                        <input class="form-check-input"
                               type="checkbox"
                               name="addOrderIds"
                               value="@order.Id"
                               id="availableOrder_@order.Id"
                               data-weight="@order.Weight"
                               data-volume="@order.Volume"
                               data-latitude="@order.Latitude"
                               data-longitude="@order.Longitude" />
                        <label class="form-check-label" for="availableOrder_@order.Id">
                            #@order.Id - @order.Address (Placed: @order.PlacedDate.ToString("d"))
                        </label>
                    </div>
                }
            }
            else
            {
                <p class="text-muted">No available orders to add.</p>
            }
        </div>
    </div>

    <button id="updateDeliveryButton" type="submit" class="btn btn-primary">Update Delivery</button>
</form>

<div id="map" style="width: 100%; height: 500px; margin-top: 20px;"></div>