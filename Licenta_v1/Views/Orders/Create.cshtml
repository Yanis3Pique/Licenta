@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model Licenta_v1.Models.Order
@{
    ViewBag.Title = "Create Order";
}

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="~/js/map_create_order.js"></script>

<h2 class="text-center">@ViewBag.Title</h2>
<br />

<div class="container">
    <form asp-action="Create" method="post">
        <div class="form-group mb-3">
            @Html.LabelFor(o => o.Priority, "Priority")
            @Html.DropDownListFor(o => o.Priority, new SelectList(Enum.GetValues(typeof(OrderPriority))), "Select priority", new { @class = "form-select" })
            @Html.ValidationMessageFor(o => o.Priority, null, new { @class = "text-danger" })
        </div>

        <div class="form-group mb-3">
            @Html.LabelFor(o => o.Weight, "Weight")
            @Html.TextBoxFor(o => o.Weight, new { @class = "form-control", @placeholder = "Enter weight (kg)", @type = "number", @step = "0.01" })
            @Html.ValidationMessageFor(o => o.Weight, null, new { @class = "text-danger" })
        </div>

        <div class="form-group mb-3">
            @Html.LabelFor(o => o.Volume, "Volume")
            @Html.TextBoxFor(o => o.Volume, new { @class = "form-control", @placeholder = "Enter volume (m³)", @type = "number", @step = "0.01" })
            @Html.ValidationMessageFor(o => o.Volume, null, new { @class = "text-danger" })
        </div>

        <div class="form-group">
            @Html.LabelFor(o => o.Address)
            @Html.EditorFor(o => o.Address, new { htmlAttributes = new { @class = "form-control", id = "address" } })
            @Html.ValidationMessageFor(o => o.Address, null, new { @class = "text-danger" })
        </div>

        <div id="map" style="height: 400px; margin-bottom: 20px; border: 2px solid black;"></div>
        <br />

        <input type="hidden" id="latitude" asp-for="Latitude" value="@ViewBag.Latitude" />
        <input type="hidden" id="longitude" asp-for="Longitude" value="@ViewBag.Longitude" />

        <!-- Dropdown-ul va fi ascuns complet -->
        <select id="region" name="RegionId" class="form-control d-none">
            <option value="">Select a region</option>
            @foreach (var region in ViewBag.Regions as IEnumerable<SelectListItem>)
            {
                <option value="@region.Value" selected="@(region.Selected ? "selected" : "")">@region.Text</option>
            }
        </select>

        <!-- Input hidden care trimite valoarea către server -->
        <input type="hidden" id="hiddenRegion" name="RegionId" value="" />

        <br />

        @if (User.IsInRole("Admin"))
        {
            <div class="form-group mb-3">
                @Html.LabelFor(m => m.ClientId, "Client", new { @class = "form-label" })
                @Html.DropDownListFor(m => m.ClientId, ViewBag.Clients as IEnumerable<SelectListItem>, "Select a client", new { @class = "form-select" })
                @Html.ValidationMessageFor(m => m.ClientId, null, new { @class = "text-danger" })
            </div>
        }

        <button type="submit" class="btn btn-primary">Create Order</button>
    </form>
</div>