@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

@model IEnumerable<Licenta_v1.Models.ApplicationUser>
@{
	ViewBag.Title = "Index-Users";
}

<h2 class="text-center">Users</h2>

<!-- Cautare si filtrare custom -->
<form method="get" class="form-inline mb-3">
    <div class="form-group mr-2">
        @Html.TextBox("searchString", ViewBag.SearchString as string, new { @class = "form-control", placeholder = "Search users" })
    </div>
    <div class="form-group mr-2">
        @Html.DropDownList("regionId", ViewBag.Regions as SelectList, "All Regions", new { @class = "form-control" })
    </div>
    <button type="submit" class="btn btn-primary">Filter</button>
</form>

<!-- Link-uri pentru sortare -->
<div class="mb-3">
    <p>
        Sort by:
        @Html.ActionLink("Name", "Index", new { sortOrder = ViewBag.NameSortParam, searchString = ViewBag.SearchString, regionId = ViewBag.RegionId, pageNumber = ViewBag.PageNumber })
        |
        @Html.ActionLink("Name Desc", "Index", new { sortOrder = ViewBag.NameSortParamDesc, searchString = ViewBag.SearchString, regionId = ViewBag.RegionId, pageNumber = ViewBag.PageNumber })
        |
        @Html.ActionLink("Date Hired", "Index", new { sortOrder = ViewBag.DateSortParam, searchString = ViewBag.SearchString, regionId = ViewBag.RegionId, pageNumber = ViewBag.PageNumber })
    </p>
</div>

<!-- Tabelul cu useri -->
<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>User Name</th>
            <th>First Name</th>
            <th>Last Name</th>
            <th>Region</th>
            <th>Date Hired</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var user in Model)
        {
            <tr>
                <td>@user.UserName</td>
                <td>@user.FirstName</td>
                <td>@user.LastName</td>
                <td>@(user.Region?.County ?? "N/A")</td>
                <td>@(user.DateHired)</td>
                <td>
                    @Html.ActionLink("Details", "Show", new { id = user.Id }, new { @class = "btn btn-sm btn-info" })
                    @Html.ActionLink("Edit", "Edit", new { id = user.Id }, new { @class = "btn btn-sm btn-warning" })
                    @using (Html.BeginForm("Delete", "Users", new { id = user.Id }, FormMethod.Post, false, new { @class = "form-inline", onsubmit = "return confirm('Are you sure you want to delete this user?');" }))
                    {
                        <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                    }
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Paginarea userilor -->
<nav>
    <ul class="pagination">
        @{
            int totalPages = ViewBag.TotalPages;
            int pageNumber = ViewBag.PageNumber;
            string query = $"&searchString={ViewBag.SearchString}&regionId={ViewBag.RegionId}&sortOrder={ViewBag.CurrentSort}";
        }

        <li class="page-item @(pageNumber == 1 ? "disabled" : "")">
            <a class="page-link" href="?pageNumber=@(pageNumber - 1)@query">Previous</a>
        </li>

        @for (int i = 1; i <= totalPages; i++)
        {
            <li class="page-item @(i == pageNumber ? "active" : "")">
                <a class="page-link" href="?pageNumber=@i@query">@i</a>
            </li>
        }

        <li class="page-item @(pageNumber == totalPages ? "disabled" : "")">
            <a class="page-link" href="?pageNumber=@(pageNumber + 1)@query">Next</a>
        </li>
    </ul>
</nav>
